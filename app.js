const yearEl=document.getElementById('year');if(yearEl)yearEl.textContent=new Date().getFullYear();async function loadArticles(){try{const res=await fetch('/data/articles.json',{cache:'no-store'});if(!res.ok)throw new Error('Gagal memuat artikel');const data=await res.json();renderArticles(data.articles||[]);}catch(err){console.error(err);document.getElementById('articles').innerHTML='<p class="lead">Tidak dapat memuat berita.</p>';}}function renderArticles(list){const root=document.getElementById('articles');if(!list.length){root.innerHTML='<p class="lead">Belum ada artikel.</p>';return;}root.innerHTML=list.map((a,i)=>`<article class="card"><div class="thumb" style="background-image:url(${a.thumbnail||'https://via.placeholder.com/800x400?text=TV+NUSANTARA+45'})"></div><div class="meta"><h3>${escapeHtml(a.title)}</h3><p>${escapeHtml(a.excerpt||(a.body||'').slice(0,140))}</p><a href="#" class="read-btn" data-index="${i}">Baca</a></div></article>`).join('');root.querySelectorAll('.read-btn').forEach(btn=>{btn.addEventListener('click',e=>{e.preventDefault();const idx=Number(btn.dataset.index);openModal(list[idx]);});});}function openModal(article){const modal=document.getElementById('articleModal');const container=document.getElementById('modalArticle');let videoEmbed='';if(article.video_url){const url=new URL(article.video_url);const videoId=url.searchParams.get('v')||url.pathname.split('/').pop();if(videoId){videoEmbed=`<div class="video-wrapper"><iframe width="560" height="315" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe></div>`;}}container.innerHTML=`<h2>${escapeHtml(article.title)}</h2><p style="color:var(--muted)">${escapeHtml(article.date||'')} â€” ${escapeHtml(article.author||'TV NUSANTARA 45')}</p>${videoEmbed}<hr /><div class="article-body">${marked.parse(article.body||'')}</div>`;modal.setAttribute('aria-hidden','false');}function closeModal(){document.getElementById('articleModal').setAttribute('aria-hidden','true');}document.getElementById('closeModal').addEventListener('click',closeModal);document.getElementById('articleModal').addEventListener('click',e=>{if(e.target.id==='articleModal')closeModal();});function escapeHtml(unsafe){return(unsafe||'').toString().replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#039;'}[m]));}loadArticles();